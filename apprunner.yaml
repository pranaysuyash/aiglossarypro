version: 1.0
runtime: nodejs18
build:
  commands:
    pre-build:
      - npm install -g pnpm
      - export PATH=$PATH:$(npm config get prefix)/bin
    build:
      - pnpm install --no-frozen-lockfile
      - cd apps/api && SKIP_TYPE_CHECK=true NODE_ENV=production pnpm run build
run:
  runtime-version: 18
  command: cd apps/api && NODE_ENV=production node dist/index.js
  network:
    port: 8080
    env: PORT
  env:
    - name: NODE_ENV
      value: production
    - name: PORT
      value: "8080"
    - name: DATABASE_URL
      value: "postgresql://neondb_owner:npg_9dlJKInqoT1w@ep-wandering-morning-a5u0szvw.us-east-2.aws.neon.tech/neondb?sslmode=require"
    - name: SESSION_SECRET
      value: "JCmY1YTJ2lXuEKhHgKZURZfub9S7WNQgy5Om2NFDdWu3dg0CtqB7wQGyXHzQG2sqDVAkGE9H9ual6uc1cVn8LA=="
    - name: JWT_SECRET
      value: "JCmY1YTJ2lXuEKhHgKZURZfub9S7WNQgy5Om2NFDdWu3dg0CtqB7wQGyXHzQG2sqDVAkGE9H9ual6uc1cVn8LA=="